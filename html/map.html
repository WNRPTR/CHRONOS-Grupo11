<!DOCTYPE html>
<html>

<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/css/bootstrap.min.css"
        integrity="sha384-r4NyP46KrjDleawBgD5tp8Y7UzmLA05oM1iAEQ17CSuDqnUK2+k9luXQOfXJCJ4I" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.0.0-alpha1/js/bootstrap.min.js"
        integrity="sha384-oesi62hOLfzrys4LxRF63OJCXdXDipiYWBnvTl9Y9/TRlw5xlKIEHpNyvvDShgf/"
        crossorigin="anonymous"></script>

    <title>Google Maps</title>
    <meta name="viewport" content="initial-scale=1.0" />
    <meta charset="utf-8" />
    <style>
        /* Always set the map height explicitly to define the size of the div element that contains the map. */
        #map {
            height: 690px;
        }
    </style>
</head>

<body>
    <!-- NavBar -->
    <nav class="navbar navbar-expand-md navbar-light" style="background-color: #9DDDFE;">
        <div class="container-fluid">
            <a class="navbar-brand" href="initialPage.html"><img src="../img/logo 1-2.png" id="logo" width="30%"><img
                    src="../img/logo 2-2.png" id="logo" width="50"></a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarID"
                aria-controls="navbarID" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarID" style="justify-content: flex-end;">
                <div class="navbar-nav">
                    <a class="nav-link active categoryListTarget" aria-current="page" id="categoryKitchen"
                        href="categoryList.html">Receita</a>
                    <a class="nav-link active categoryListTarget"" aria-current=" page" id="categorySport"
                        href="categoryList.html">Desporto</a>
                    <a class="nav-link active categoryListTarget"" aria-current=" page" id="categoryBook"
                        href="categoryList.html">Livro</a>
                    <a class="nav-link active" aria-current="page" href="map.html">Ajuda psicológica</a>
                    <a class="nav-link active" aria-current="page" href="profile.html">Perfil</a>
                </div>
            </div>
        </div>
    </nav>





    <div id="map"></div>




    <script async
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD5uLBWQM4CRaEaAel5qberiBvpGKO5qyw&callback=initMap&libraries=places">
        </script>

    <script>
        function initMap() {
            const map = new google.maps.Map(document.getElementById("map"), {
                center: { lat: -34.397, lng: 150.644 },
                zoom: 18
            });


            infoWindow = new google.maps.InfoWindow();


            //try HTML5 geolocation
            if (navigator.geolocation) {
                navigator.geolocation.watchPosition(
                    position => {
                        const pos = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        infoWindow.setPosition(pos);
                        infoWindow.setContent("Location found");
                        infoWindow.open(map);
                        map.setCenter(pos);

                        const contentString = `ok
                            <div id="content">
                                <h1>ESMAD</h1>
                                <p> A <b>ESMAD</b> é uma das escolas do P.PORTO!</p>
                                <p><img src="https://www.esmad.ipp.pt/logo-ipp.png"/></p>
                            </div>
                        `

                        const infowindow2 = new google.maps.InfoWindow({ content: contentString })

                        const marker = new google.maps.Marker({
                            position: pos,
                            map: map
                        })

                        marker.addListener("click",
                            () => infowindow2.open(map, marker)
                        )





                        const request = {
                            location: pos,
                            radius: '100',
                            type: ['restaurant']
                        };


                        service = new google.maps.places.PlacesService(map);
                        service.nearbySearch(request, callback);

                        function callback(result, status) {
                            if (status == google.maps.places.PlacesServiceStatus.OK) {
                                for (const result of results) {
                                    createMarker(result);
                                }
                                map.setCenter(results[0].geometry.location);
                            }
                        }


                        function createMarker(place) {
                            const marker2 = new google.maps.Marker({
                                map: map,
                                position: place.geometry.location
                            });

                            google.maps.event.addListener(marker2, 'click', function () {
                                infowindow.sentContent(place, name);
                                infowindow.open(map, this);
                            })
                        }
                    },
                    () => handleLocationError(true, infoWindow, map.getCenter())
                );





            } else {
                // Browser doesn't support geolocation
                handleLocationError(false, infoWindow, map.getCenter());
            }
        }


        function handleLocationError(browserHasGeolocation, infoWindow, pos) {
            infoWindow.setPosition(pos);
            infoWindow.setContent(browserHasGeolocation ? "Error: The Geolocation service failed" : "Error: your browser doesn't support geolocation."
            );

            infoWindow.open(map);
        }





    </script>



</body>

</html>